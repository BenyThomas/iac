apiVersion: v1
kind: ConfigMap
metadata:
  name: argocd-cm
  namespace: argocd
data:
  url: https://argocd.tcbbank.co.tz
  oidc.config: |
    name: okta
    issuer: https://idp.tcbbank.co.tz/oauth2/default
    clientID: $oidc.okta.clientId
    clientSecret: $oidc.okta.clientSecret
    requestedScopes: ["openid", "profile", "email", "groups"]
    requestedIDTokenClaims:
      groups:
        essential: true

---
apiVersion: v1
kind: ConfigMap
metadata:
  name: argocd-rbac-cm
  namespace: argocd
data:
  policy.default: role:readonly
  policy.csv: |
    g, platform-admins, role:platform-admin
    g, platform-readers, role:platform-readonly
    p, role:platform-admin, applications, *, platform/*, allow
    p, role:platform-admin, projects, *, platform, allow
    p, role:platform-admin, clusters, *, *, allow
    p, role:platform-readonly, applications, get, platform/*, allow
    p, role:platform-readonly, projects, get, platform, allow
  scopes: '[groups]'

---
apiVersion: v1
kind: Secret
metadata:
  name: argocd-secret
  namespace: argocd
stringData:
  oidc.okta.clientId: REPLACE_ME
  oidc.okta.clientSecret: REPLACE_ME
type: Opaque
